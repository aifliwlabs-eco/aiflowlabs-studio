<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>aiflowlabs.studio — Coming Soon</title>
  <meta name="description" content="AIFlow Labs Studio — AI agents, creative tools & apps. Launching soon." />
  <meta name="theme-color" content="#0A0A0A" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MZ733KQK');</script>
<!-- End Google Tag Manager -->

  <style>
    :root{ --bg-1:#0b0f14; --bg-2:#0c1220; --grad-a:#00d4ff; --grad-b:#ff0080; --grad-c:#7cff96; --text:#e9eef5; --muted:#93a0b3; --ring:rgba(255,255,255,.12); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, sans-serif;
      color:var(--text); background: radial-gradient(1200px 900px at 70% -10%, #15203a 0%, transparent 60%), linear-gradient(180deg,var(--bg-1),var(--bg-2));
      display:flex; align-items:center; justify-content:center; overflow:hidden;
    }

    .ribbon{
      position:absolute; inset:auto -20vw 50% -20vw; height:44vh; pointer-events:none; filter: blur(24px) saturate(1.3) contrast(1.05);
      background: radial-gradient(60% 140% at 10% 40%, rgba(0,212,255,.45), transparent 60%),
                  radial-gradient(60% 140% at 90% 60%, rgba(255,0,128,.45), transparent 60%);
      mix-blend-mode:screen; opacity:.65; animation: float 14s ease-in-out infinite; transform:translateY(10vh) rotate(-6deg);
    }
    @keyframes float{ 0%,100%{transform:translateY(10vh) rotate(-6deg)} 50%{transform:translateY(14vh) rotate(-8deg)} }

    .card{
      position:relative; width:min(860px,92vw); padding:48px 28px; border-radius:20px; text-align:center;
      background: rgba(255,255,255,.06);
      box-shadow: 0 10px 40px rgba(0,0,0,.35), inset 0 0 0 1px var(--ring);
      backdrop-filter: blur(14px) saturate(1.2);
    }
    .logo{
      display:inline-flex; gap:.6ch; align-items:center; padding:.55rem .9rem; border-radius:999px;
      background:rgba(255,255,255,.06); box-shadow: inset 0 0 0 1px var(--ring);
      font-weight:600; letter-spacing:.4px;
    }
    .logo b{
      background: linear-gradient(90deg,var(--grad-a),var(--grad-b),var(--grad-c));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    h1{
      margin:18px 0 6px; font-size: clamp(28px, 5vw, 48px); line-height:1.05;
      background: linear-gradient(90deg,var(--grad-a),var(--grad-b));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      animation: hue 10s linear infinite;
    }
    @keyframes hue{ from{filter:hue-rotate(0)} to{filter:hue-rotate(360deg)} }
    .lead{ margin:0 auto 18px; max-width:60ch; color:var(--muted); font-size:clamp(15px,2.6vw,18px); }
    .typing{ display:inline-block; border-right:2px solid rgba(255,255,255,.7); white-space:nowrap; overflow:hidden; width:0; animation:type 3.8s steps(36,end) forwards,blink .9s step-end infinite;}
    @keyframes type{to{width:36ch}} @keyframes blink{50%{border-color:transparent}}

    .row{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:18px }

    .btn{
      text-decoration:none; font-weight:600; padding:12px 16px; border-radius:12px; display:inline-flex; align-items:center; gap:.5rem;
      color:#0b0f14; cursor:pointer; border:0;
      transition: transform .15s ease, filter .15s ease, box-shadow .15s ease;
    }
    .btn.grad{ background:linear-gradient(90deg,var(--grad-a),var(--grad-b)); box-shadow:0 6px 18px rgba(0,212,255,.25) }
    .btn.grad:hover{ transform:translateY(-1px); filter:brightness(1.05) }

    .btn.with-play{ position:relative; padding-left:18px; }
    .btn.with-play::before{
      content:""; display:inline-block; width:0; height:0;
      border-top:6px solid transparent; border-bottom:6px solid transparent; border-left:10px solid currentColor;
      margin-right:8px; transform:translateY(1px);
    }

    .msg{ font-size:14px; margin-top:12px }
    .msg.ok{ color:#7cff96 } .msg.err{ color:#ff7a7a }

    footer{ position:fixed; bottom:14px; left:0; right:0; text-align:center; color:#94a2b8; font-size:12px }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; place-items:center; padding:20px; background:rgba(5,8,13,.55); backdrop-filter: blur(6px); z-index:50; }
    .modal.open{ display:grid }
    .modal-card{
      width:min(460px,92vw); border-radius:16px; padding:22px; text-align:left; position:relative;
      background: rgba(255,255,255,.07);
      box-shadow: 0 10px 40px rgba(0,0,0,.45), inset 0 0 0 1px var(--ring);
      backdrop-filter: blur(14px) saturate(1.2);
    }
    .modal-title{ margin:4px 0 6px; font-size:22px; font-weight:700 }
    .modal-sub{ margin:0 0 14px; color:var(--muted) }
    .modal-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; align-items:center }
    .input{ flex:1; border:1px solid var(--ring); background:rgba(255,255,255,.06); color:var(--text); border-radius:12px; padding:12px 14px; outline:none; }
    .input::placeholder{ color:#b6c2d4 }
    .close-x{ position:absolute; right:14px; top:14px; background:transparent; border:0; color:#cbd5e1; cursor:pointer; font-size:18px; }
  </style>
  </head>
<body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZ733KQK"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <div class="ribbon" aria-hidden="true"></div>

  <main class="card" role="main">
    <span class="logo"><b>AIFlow</b> Labs Studio</span>
    <h1>We’re launching soon</h1>
    <p class="lead"><span class="typing">AI agents • creative tools • applied research</span></p>

    <div class="row">
      <button id="openWaitlist" class="btn grad" type="button">Notify me</button>
      <a class="btn grad with-play" href="#" onclick="alert('AIFlow Labs Studio YouTube channel is coming soon!'); return false;" aria-label="AIFlow Labs Studio YouTube">
        YouTube
      </a>
    </div>
    <div id="feedback" class="msg" role="status" aria-live="polite"></div>
  </main>

  <footer>© 2025 aiflowlabs.studio</footer>

  <!-- Modal -->
  <div id="waitlistModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <button class="close-x" type="button" aria-label="Close">✕</button>
      <div class="modal-title">Join the waitlist</div>
      <p class="modal-sub">Leave your name and email — we’ll notify you when early access opens.</p>

      <!-- IMPORTANT: Replace ACTION_URL below with your latest Web App /exec URL -->
      <form id="waitlistForm"
            action="https://script.google.com/macros/s/AKfycbwsb5nQh0vurc2laL79-r1K8VFA3_zaVwwgZCAMV_Ig012rJnBGL3lfYF0OEQMKx6TJ/exec?pm=1"
            method="POST"
            target="hidden_iframe"
            novalidate>
        <!-- Honeypot (must stay empty) -->
        <input type="text" name="company" tabindex="-1" autocomplete="off"
               style="position:absolute; left:-9999px; opacity:0" aria-hidden="true">
        <!-- Explicit postMessage flag (duplicated in URL) -->
        <input type="hidden" name="pm" value="1">

        <div class="modal-actions">
          <input class="input" type="text"  name="name"  placeholder="Your name" required>
          <input class="input" type="email" name="email" placeholder="you@example.com" required>
          <button class="btn grad" type="submit">Send</button>
        </div>

        <div id="modalMsg" class="msg" role="status" aria-live="polite"></div>
      </form>

      <iframe name="hidden_iframe" style="display:none;"></iframe>
    </div>
  </div>

  <script>
    // --- Modal open/close ---
    const openBtn = document.getElementById('openWaitlist');
    const modal   = document.getElementById('waitlistModal');
    const closeX  = modal.querySelector('.close-x');

    // --- Form + hidden iframe + robust feedback ---
    const form     = document.getElementById('waitlistForm');
    const modalMsg = document.getElementById('modalMsg');
    const pageMsg  = document.getElementById('feedback');
    const iframe   = document.querySelector('iframe[name="hidden_iframe"]');
    const hpField  = form.querySelector('input[name="company"]'); // honeypot

    let inFlight = false;
    let ackTimer = null;

    function resetUI() {
      clearTimeout(ackTimer);
      inFlight = false;
      modalMsg.className = 'msg';
      modalMsg.textContent = '';
      if (pageMsg) { pageMsg.className = 'msg'; pageMsg.textContent = ''; }
      const btn = form.querySelector('button[type="submit"]');
      if (btn) { btn.disabled = false; btn.textContent = 'Send'; }
    }

    openBtn.addEventListener('click', () => {
      if (hpField) hpField.value = ''; // clear honeypot on open
      resetUI();
      modal.classList.add('open');
    });

    closeX.addEventListener('click', () => modal.classList.remove('open'));
    modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('open'); });

    // Allowed origins for Apps Script postMessage
    const TRUSTED_ORIGINS = [
      'https://script.google.com',
      'https://script.googleusercontent.com',
    ];

    // Validation and submit start
    form.addEventListener('submit', (e) => {
      // Never block on honeypot — just clear it (some extensions may autofill it)
      if (hpField && hpField.value) hpField.value = '';

      const name  = form.name.value.trim();
      const email = form.email.value.trim();

      modalMsg.className = 'msg';
      modalMsg.textContent = '';

      if (!name) {
        e.preventDefault();
        modalMsg.classList.add('err');
        modalMsg.textContent = 'Please enter your name.';
        return;
      }
      if (!/^\S+@\S+\.\S+$/.test(email)) {
        e.preventDefault();
        modalMsg.classList.add('err');
        modalMsg.textContent = 'Please enter a valid email.';
        return;
      }

      // UI state: lock button and set waiting flags
      const btn = form.querySelector('button[type="submit"]');
      if (btn) { btn.disabled = true; btn.textContent = 'Sending…'; }
      inFlight = true;

      // Single-use onload fallback: if postMessage never arrives, we still release the UI
      const onLoadOnce = () => {
        if (!inFlight) return; // already handled by postMessage
        clearTimeout(ackTimer);

        // Fallback optimistic message (exact status may arrive later via postMessage)
        modalMsg.className = 'msg ok';
        modalMsg.textContent = 'Request received — check your email shortly.';
        if (pageMsg) { pageMsg.className = 'msg ok'; pageMsg.textContent = 'Request received.'; }

        if (btn) { btn.disabled = false; btn.textContent = 'Send'; }
        inFlight = false;
      };
      iframe.addEventListener('load', onLoadOnce, { once: true });

      // Safety timeout (in case extensions block postMessage)
      clearTimeout(ackTimer);
      ackTimer = setTimeout(() => {
        if (!inFlight) return;
        modalMsg.className = 'msg err';
        modalMsg.textContent = 'Still sending… If this hangs, try Incognito (extensions may block the response).';
        if (btn) { btn.disabled = false; btn.textContent = 'Send'; }
        inFlight = false;
      }, 10000);
      // IMPORTANT: do NOT preventDefault — the form must actually submit to the iframe
    });

    // Receive response from Apps Script via postMessage
    window.addEventListener('message', (ev) => {
      // Filter by origin (iframe gets recreated; source object changes)
      if (!TRUSTED_ORIGINS.some(o => ev.origin && ev.origin.startsWith(o))) return;

      const data = ev?.data;
      if (!data || typeof data !== 'object') return;

      clearTimeout(ackTimer);
      inFlight = false;

      const btn = form.querySelector('button[type="submit"]');
      if (btn) { btn.disabled = false; btn.textContent = 'Send'; }

      if (data.ok === false) {
        modalMsg.className = 'msg err';
        modalMsg.textContent = 'Something went wrong. Please try again.';
        return;
      }

      // Quota exhausted: inform user emails will be sent later
      if (data.ok === true && data.reason === 'quota_exhausted') {
        modalMsg.className = 'msg ok';
        modalMsg.textContent = 'Request accepted. We will email you later (email quota is temporarily exhausted).';
        if (pageMsg) { pageMsg.className = 'msg ok'; pageMsg.textContent = 'Accepted; email will be sent later.'; }
        form.reset();
        return;
      }

      // Normal success branches
      if (data.ok === true) {
        if (data.duplicate) {
          modalMsg.className = 'msg ok';
          modalMsg.textContent = 'You’re already on the list — we’ll keep you posted.';
          if (pageMsg) { pageMsg.className = 'msg ok'; pageMsg.textContent = 'Already subscribed.'; }
        } else {
          modalMsg.className = 'msg ok';
          modalMsg.textContent = 'Thanks! You’re on the list.';
          if (pageMsg) { pageMsg.className = 'msg ok'; pageMsg.textContent = 'Subscription confirmed.'; }
        }
        form.reset();
      }
    });
  </script>
</body>
</html>
